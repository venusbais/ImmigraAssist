{% extends "attorney_base.html" %}

{% block title %}Cases - Attorney Corner{% endblock %}

{% block attorney_content %}
<div class="card">
    <div class="card-header">
        <h2>Case Management</h2>
        <a href="#" class="btn btn-primary"><i class="fas fa-plus"></i> New Case</a>
    </div>
    <div class="card-body">
        <div class="filter-controls">
            <select id="status-filter" class="form-control">
                <option value="all">All Statuses</option>
                <option value="pending">Pending</option>
                <option value="under review">Under Review</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
            </select>
            <select id="case-type-filter" class="form-control">
                <option value="all">All Case Types</option>
                <option value="I-129">I-129 Petition</option>
                <option value="I-130">I-130 Petition</option>
                <option value="I-140">I-140 Petition</option>
                <option value="I-485">I-485 Adjustment</option>
                <option value="I-765">I-765 Work Permit</option>
                <option value="N-400">N-400 Naturalization</option>
            </select>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-case" placeholder="Search cases...">
            </div>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="active-cases">Active Cases ({{ active_cases|length }})</div>
                <div class="tab" data-tab="archived-cases">Archived Cases ({{ archived_cases|length }})</div>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="active-cases">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Case Number</th>
                                <th>Client</th>
                                <th>Case Type</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Filed Date</th>
                                <th>Last Update</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for case in active_cases %}
                            <tr class="case-row">
                                <td><a href="{{ url_for('attorney_petition_details', petition_id=case.id) }}">#{{ case.id }}</a></td>
                                <td>{{ case.beneficiary_name }}</td>
                                <td>{{ case.visa_type }}</td>
                                <td><span class="status-badge status-{{ case.status|lower }}">{{ case.status }}</span></td>
                                <td>
                                    {% if case.priority == 'high' %}
                                    <span class="priority-badge priority-high">High</span>
                                    {% elif case.priority == 'medium' %}
                                    <span class="priority-badge priority-medium">Medium</span>
                                    {% else %}
                                    <span class="priority-badge priority-low">Low</span>
                                    {% endif %}
                                </td>
                                <td>{{ case.priority_date }}</td>
                                <td>{{ case.last_updated }}</td>
                                <td>
                                    <div class="action-menu">
                                        <button class="btn btn-sm btn-secondary dropdown-toggle">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div class="dropdown-menu">
                                            <a href="{{ url_for('attorney_petition_details', petition_id=case.id) }}" class="dropdown-item">
                                                <i class="fas fa-eye"></i> View Details
                                            </a>
                                            <a href="#" class="dropdown-item">
                                                <i class="fas fa-edit"></i> Edit Case
                                            </a>
                                            <a href="#" class="dropdown-item">
                                                <i class="fas fa-file-alt"></i> Generate Documents
                                            </a>
                                            <a href="#" class="dropdown-item">
                                                <i class="fas fa-archive"></i> Archive Case
                                            </a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane" id="archived-cases">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Case Number</th>
                                <th>Client</th>
                                <th>Case Type</th>
                                <th>Status</th>
                                <th>Filed Date</th>
                                <th>Archived Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for case in archived_cases %}
                            <tr class="case-row">
                                <td><a href="{{ url_for('attorney_petition_details', petition_id=case.id) }}">#{{ case.id }}</a></td>
                                <td>{{ case.beneficiary_name }}</td>
                                <td>{{ case.visa_type }}</td>
                                <td><span class="status-badge status-{{ case.status|lower }}">{{ case.status }}</span></td>
                                <td>{{ case.priority_date if case.priority_date else '-' }}</td>
                                <td>{{ case.close_date }}</td>
                                <td>
                                    <div class="action-menu">
                                        <button class="btn btn-sm btn-secondary dropdown-toggle">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div class="dropdown-menu">
                                            <a href="{{ url_for('attorney_petition_details', petition_id=case.id) }}" class="dropdown-item">
                                                <i class="fas fa-eye"></i> View Details
                                            </a>
                                            <a href="#" class="dropdown-item">
                                                <i class="fas fa-undo"></i> Restore Case
                                            </a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.tab');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Deactivate all tabs
            tabs.forEach(t => t.classList.remove('active'));
            tabPanes.forEach(p => p.classList.remove('active'));
            
            // Activate selected tab
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Case filtering
    const statusFilter = document.getElementById('status-filter');
    const caseTypeFilter = document.getElementById('case-type-filter');
    const searchInput = document.getElementById('search-case');
    const caseRows = document.querySelectorAll('.case-row');
    
    function filterCases() {
        const statusValue = statusFilter.value.toLowerCase();
        const caseTypeValue = caseTypeFilter.value.toLowerCase();
        const searchValue = searchInput.value.toLowerCase();
        
        caseRows.forEach(row => {
            const statusText = row.querySelector('.status-badge').textContent.toLowerCase();
            const caseTypeText = row.cells[2].textContent.toLowerCase();
            const clientName = row.cells[1].textContent.toLowerCase();
            const caseNumber = row.cells[0].textContent.toLowerCase();
            
            const statusMatch = statusValue === 'all' || statusText === statusValue;
            const caseTypeMatch = caseTypeValue === 'all' || caseTypeText.includes(caseTypeValue);
            const searchMatch = searchValue === '' || 
                clientName.includes(searchValue) || 
                caseNumber.includes(searchValue);
            
            if (statusMatch && caseTypeMatch && searchMatch) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
    
    if (statusFilter) statusFilter.addEventListener('change', filterCases);
    if (caseTypeFilter) caseTypeFilter.addEventListener('change', filterCases);
    if (searchInput) searchInput.addEventListener('input', filterCases);
    
    // Dropdown menus
    const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
    
    dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function(e) {
            e.stopPropagation();
            const dropdown = this.nextElementSibling;
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                if (menu !== dropdown) {
                    menu.classList.remove('show');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('show');
        });
    });
    
    // Close dropdowns when clicking elsewhere
    document.addEventListener('click', function() {
        document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
            menu.classList.remove('show');
        });
    });
});
</script>
{% endblock %}
